{% extends 'base.html' %}
{% block content %}
{% load static %}
<div class="p-3">
    <div class="container">
        <div class="row mt-3">
            <div class="col-md-6 mx-auto mb-3">
                <h2>{{ template_data.movie.name }}</h2>
                <hr />
                <p><b>Description:</b> {{template_data.movie.description }}</p>
                <p><b>Average Rating:</b> {{template_data.movie.rating }} stars</p>
                <p><b>Price:</b> ${{template_data.movie.price }}</p>
                <p class="card-text">
                <form method="post" action="{% url 'cart.add' id=template_data.movie.id %}">
                    <div class="row">
                        {% csrf_token %}
                        <div class="col-auto">
                            <div class="input-group col-auto">
                                <div class="input-group-text">Quantity</div>
                                <input type="number" min="1" max="10" class="form-control quantity-input"
                                    name="quantity" value="1">
                            </div>
                        </div>
                        <div class="col-auto">
                            <button class="btn bg-dark text-white" type="submit">Add to cart</button>
                        </div>
                        
                        {% if user.is_authenticated %}
                        <div class="col-auto">
                            <!--if user has not added to watchlist-->
                            {% if user in template_data.movie.watch_list.all %}
                            <a class="btn btn-danger"
                                href="{% url 'movies.add_watchlist' id=template_data.movie.id %}">Remove from Watch List
                            </a>
                            <!--if user has not added to watchlist-->
                            {% else %}
                            <a class="btn btn-success"
                                href="{% url 'movies.add_watchlist' id=template_data.movie.id %}">Add to Wacth List
                            </a>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </form>
                </p>
                <h2>Reviews</h2>
                <hr />
                <ul class="list-group">
                    {% for review in template_data.reviews %}
                    <li class="list-group-item pb-3 pt-3">
                        <h5 class="card-title">
                            Review by {{ review.user.username }}
                        </h5>
                        <h6 class="card-subtitle mb-2 text-muted"> {{ review.date }}
                        </h6>

                        <p class="card-text">{{ review.stars }} stars</p>

                        <p class="card-text">{{ review.comment }}</p>

                        <!--text for like-->
                        <p class="card-text">❤️ {{ review.likes.count }}</p>

                        <!--like button-->

                        {% if user.is_authenticated %}

                        <!--if user has already liked-->
                        {% if user in review.likes.all %}
                        <a class="btn btn-danger"
                            href="{% url 'movies.like_review' id=template_data.movie.id review_id=review.id %}">Unlike
                        </a>
                        <!--if user has not liked-->
                        {% else %}
                        <a class="btn btn-success"
                            href="{% url 'movies.like_review' id=template_data.movie.id review_id=review.id %}">Like
                        </a>
                        {% endif %}
                        {% endif %}

                        {% if user.is_authenticated and user == review.user %}
                        <a class="btn btn-primary"
                            href="{% url 'movies.edit_review' id=template_data.movie.id review_id=review.id %}">Edit
                        </a>
                        <a class="btn btn-danger"
                            href="{% url 'movies.delete_review' id=template_data.movie.id review_id=review.id %}">Delete
                        </a>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                {% if user.is_authenticated %}
                <div class="container mt-4">
                    <div class="row justify-content-center">
                        <div class="col-12">
                            <div class="card shadow p-3 mb-4 rounded">
                                <div class="card-body">
                                    <b class="text-start">Create a review</b><br /><br />
                                    <form method="POST"
                                        action="{% url 'movies.create_review' id=template_data.movie.id %}">
                                        {%csrf_token%}
                                        <p>
                                            <style>
                                                .star-rating {
                                                    display: flex;
                                                    flex-direction: row-reverse;
                                                    /* so 5 is on the left */
                                                    justify-content: flex-start;
                                                }

                                                .star-rating input {
                                                    display: none;
                                                    /* hide the radio buttons */
                                                }

                                                .star-rating label {
                                                    font-size: 2rem;
                                                    color: lightgray;
                                                    cursor: pointer;
                                                    transition: color 0.2s;
                                                }

                                                /* Hover effect */
                                                .star-rating label:hover,
                                                .star-rating label:hover~label {
                                                    color: gold;
                                                }

                                                /* Selected effect */
                                                .star-rating input:checked~label {
                                                    color: gold;
                                                }
                                            </style>
                                            <label for="stars">Stars:</label>
                                        <div class="star-rating">
                                            <input type="radio" id="star5" name="stars" value="5" required>
                                            <label for="star5">⭐</label>

                                            <input type="radio" id="star4" name="stars" value="4">
                                            <label for="star4">⭐</label>

                                            <input type="radio" id="star3" name="stars" value="3">
                                            <label for="star3">⭐</label>

                                            <input type="radio" id="star2" name="stars" value="2">
                                            <label for="star2">⭐</label>

                                            <input type="radio" id="star1" name="stars" value="1">
                                            <label for="star1">⭐</label>
                                        </div>
                                        <label for="comment">Comment:</label>
                                        <textarea name="comment" required class="form-control" id="comment"></textarea>
                                        </p>
                                        <div class="text-center">
                                            <button type="submit" class="btn bg-dark text-white"> Add Review
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            <div class="col-md-6 mx-auto mb-3 text-center">
                <img src="{{ template_data.movie.image.url }}" class="rounded img-card-400" />
            </div>
        </div>
    </div>
</div>
{% endblock content %}